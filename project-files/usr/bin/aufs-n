#!/bin/sh
#aufs layers list, by DdS sfs
#VERSION 3.6
header () {
echo "AUFS layers (top layer \"0\" covers all lower )"
printf %3s "N "; printf %-45s Module; printf "Path\n\n"
}

listing () {
n=0
while true; do 
    a="`cat /sys/fs/aufs/si_*/br$n 2>/dev/null`" && printf %3s "$n " && printf %-45s `basename $a` && echo `dirname $a` || break
    n=$(expr $n + 1)
done
}

if [ ! $1 ] ;then 
	header
	listing
	exit
elif echo $1 |grep -q '^[[:digit:]]*$' ; then
	cat /sys/fs/aufs/si_*/br$1 |head -n1 |sed 's/=.*//'
fi  
