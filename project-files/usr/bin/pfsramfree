#!/bin/sh
#Free RAM, by «sfs» & Zay, GPL v3.
#VERSION 3.0

. /usr/bin/pfsfunc
allow_only_root

if [ "$1" ]; then
  [ -f "$1" ] && fsname="`basename $(realpath "$1")`" || fsname="$(basename "$1")"
else
  if [ -d "${copyramdir}" ]; then
    useloop="$(losetupb -a)"
    find "${copyramdir}" -mindepth 1 -maxdepth 1 -type d 2>/dev/null | while read rampfsdir
    do
      echo "${useloop}" | grep -q -F "${rampfsdir}"
      [ $? -gt 0 ] && "$0" "$(basename "${rampfsdir}")"
    done
  fi
  exit
fi

fullname=$(echo "${copyramdir}/${fsname}" |sed 's://:/:')
echo $fullname
if [ -d "$fullname" ]; then
  mountb | grep -q -F "$fullname"
  if [ $? -eq 0 ]; then
    losetupb -a | grep -q -F "$fullname"
    if [ $? -gt 0 ]; then
      umountb "$fullname"
      if [ $? -eq 0 ]; then
        rmdir "$fullname" >/dev/null
      else
        exitmsg "ERROR free RAM!" 3
      fi
    fi
  else
    rmdir "$fullname" >/dev/null
  fi
fi
  
exit 0
  
